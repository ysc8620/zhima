<include file="Public:header" />
<div class="container">
    <input type="hidden" name="id" value="{$hongbao['number_no']}" />
	<div class="detail_header">
		<div class="detail_head_block"><img src="{$hongbao_user.header}" alt="{$hongbao_user.name}" class="detail_head_img" /></div>
	</div>
	<div class="cl"></div>
	<div class="from mt40 cl">
		<ul>
			<div class="tit mt20">
				<div class="title">{$hongbao_user.name}发的红包</div>
				<div class="remark" style="margin: 16px 0; font-size: 18px">{$hongbao.remark}</div>

                <ul >
                    <div class="tit mt20">
                        <if condition="$receive_order">
                            <div class="title"><font>您已领取：</font>￥{$receive_order.amount}元</div>
                        </if>
                    </div>
                </ul>
			</div>
		</ul>
		<div class='detail_block ' data-role="detail_default">
			<ul>
				<div class="tit">
                    <if condition="$hongbao.state eq 3 or count($order_list) eq $hongbao['total_num']">
                        <div class="title" style="font-size: 16px; margin: 8px 0;"><img src="/images/ok.png" style=" width:16px; vertical-align: middle" /> 领完啦~</div>
                        <div class="title" style="font-size: 12px; margin: 8px 0; color: #bbb">{$hongbao.total_num}个红包已领完，用时{$use_time}</div>
                    </if>
                    <div class="">
                        <if condition="$hongbao['user_id'] eq $user_id">
                            <button type="button"  onclick="set_share()" style="font-size: 24px; color: #fdf05e" class="btn btn_cou"><font>分享</font></button>
                        <elseif condition="$hongbao['is_sponsor'] eq 1" />
                            <button type="button" style="font-size: 24px; color: #fdf05e" class="btn btn_cou"><font>赞助</font></button>
                        </if>
                    </div>
                    <if condition="$hongbao['user_id'] eq $user_id and $hongbao['is_sponsor'] eq 1">
					<div class="set_sponsor">
						<a href="javascript:void(0)" style="margin-top: 10px!important; clear: both; line-height: 36px;" onclick="set_sponsor()">设为“不可赞助”</a>
					</div>
                        </if>
				</div>
			</ul>
		</div>

	</div>
	<div class="order_list">
		<div class="header bt_line">
			<span><img src="/images/sm.png" style="width:14px; line-height:14px; vertical-align:middle;" /></span> <span>已有{:count($order_list)}人领取红包，共计￥{$total_order_amount}元</span>
		</div>
		<div class="block" style="min-height: 200px;">
            <volist name="order_list" id="order" key="i">
			<ul class="bt_line p6" <if condition="$i gt 5">data-role="order" style="display:none"</if>>
				<div class="head_img fl" style="width:70px;"><img src="{$order.user.header}" alt="{$order.user.name}" class="detail_head_img2" /></div>
					<div class="detail fl">
						<li class="cl tl">{$order.user.name} <if condition="$order.id eq $star_order and $is_show_star"><img src="/images/xing.png" style="width: 14px;color: #ff9802!important " /> 手气最佳</if></li>
						<li class="cl tl" style="color: #999">{$order.addtime|date="Y-m-d H:i:s",###}</li>
					</div>

					<div class="detail fr">
						<li class="cl tr">￥{$order.amount}</li>
						<li class="cl tr" style="color: #ff9802!important" >已领取</li>
					</div>

				<div class="cl"></div>
			</ul>
                </volist>

			<div class="cl"></div>
		</div>
        <if condition="count($order_list) gt 5">
		<div class="xiala">
			<div class="view_all"><span><img src="/images/xia.png" class="img" style="width:12px;"/></span> <span class="f12">查看全部参与者</span></div>
		</div>
            </if>
		<div class="xiala">
			<div><a href="{:U('/bao/hongbao')}"><input type="button" class="btn w120" value="我发红包" /></a> <a href="{:U('/bao/notes')}" style="margin-left: 20px"><input type="button" class="btn w120" value="我的记录" /></a></div>
			<div class="cl h12"></div>
		</div>
		<div class="cl"></div>
	</div><div class="cl"></div>
	<div class="from "><div class="foot_reamrk">如果48小时内该红包没有领完, 系统会自动退还余额</div></div>
     <div class="cl" ></div>

    <div id="shareit1" style="display:  <if condition="$is_show_share and $user_id eq $hongbao['user_id']">block<else />none</if>">
        <div class="shareit"></div>
        <span style="" class="follow"> <img src="/images/share-it.png" style="height:120px;" class="arrow">
            <img src="/images/xinhongbao_bg.png" class="bg" style="left: 0; top: 0;" />
        </span>
    </div>

<div id="error_block" style="display: none">
    <div id="shareit"></div>
    <span style="" class="follow">
        <div style="padding-right: 0px; padding-left: 0px; margin-top: 16px; font-size: 20px; color: #fff" class="text"><p>被人抢先一步了...</p></div>
		<div>
            <img src="/images/ico_ku.png" style="width:80px;" />
        </div>
		<div style="padding: 0px; margin-top: 8px; font-size: 12px; color: #fff" class="text">红包已经被人抢光了~ </div>
    </span>
</div>

    <div id="remark_block" class="box_block" style='<if condition="!$receive_order and $hongbao['total_num'] gt count($order_list) and $user_id neq $hongbao['user_id']">display: block<else/>display:none</if>'>
    <div class="shareit"></div>
    <div class="follow">
        <p style="text-align: center; padding: 12px; font-size: 18px; line-height: 24px;">
            <img src="{$hongbao_user.header}" alt="{$hongbao_user.name}" class="detail_head_img" /> <br />
            <span>{$hongbao_user.name}</span><br/>
            <span style="font-size: 16px; padding-top: 12px; clear: both;">发了一个红包, 金额随机</span><br/>
            <span style="font-size: 20px; padding-top: 28px; clear: both;">”{$hongbao.remark}“</span></p>
        <img src="/images/linghongbao-banner.png" onclick="set_order()" style="width: 100%;" />
        <div class="cls" style="clear: both; margin-bottom: 6px;"></div>
        <p style="text-align: center; padding: 12px; font-size: 16px; line-height: 20px;" onclick="$('#remark_block').hide();">看看大家手气></p>
    </div>
</div>
</div>

<script type="text/javascript">
    var w = $('#follow').width();
    $('#follow img.bg').css('width', w+'px');
</script>

<include file="Public:foot" />

<script type="text/javascript">
    $('.view_all').click(function(){
        $('[data-role="order"]').toggle();
        if($('.view_all .f12').text() == '查看全部参与者'){
            $('.view_all .f12').text('收起全部参与者');
            $('.view_all .img').attr('src', '/images/shang.png');
        }else{
            $('.view_all .f12').text('查看全部参与者');
            $('.view_all .img').attr('src', '/images/xia.png');
        }
    });
</script>

<script type="text/javascript">

    //立即分享到微信朋友圈点击事件
    $("#error_block").on("click", function() {
        $("#error_block").hide();
    });

    function set_share(){
        $("#shareit1").show();
    }

    $("#shareit1").on("click", function(){
        $("#shareit1").hide();
    })

    /**
     * 设置赞赏
     */
    function set_sponsor(){
        var id = $('input[name="id"]').val();
        var index = layer.load(1, {
            shade: [0.1,'#000'] //0.1透明度的白色背景
        });
        var _this
        $.ajax({
            type:'post',
            url:"{:U('/bao/hongbao/sponsor')}",
            async:false,
            cache:false,
            data:{id:id},
            dataType:'json',
            success:function(result){
                layer.close(index);
                if(result.msg_code==10001){
                    // callpay(result.data);
                    $('.set_sponsor').remove();
                    layer.msg('设置成功', function(){});
                }else{
                    layer.msg(result.message, function(){});
                    return false;
                }
            }
        });
    }

    /**
     * 生成红包订单
     */
    function set_order(){
        var id = $('input[name="id"]').val();
        var index = layer.load(1, {
            shade: [0.1,'#000'] //0.1透明度的白色背景
        });
        $.ajax({
            type:'post',
            url:"{:U('/bao/hongbao/order')}",
            async:false,
            cache:false,
            data:{id:id},
            dataType:'json',
            success:function(result){
                layer.close(index);
                if(result.msg_code==10001){
                    // layer.msg('', function(){});
                    // 重载
                    window.location.reload();
                }else{
                    layer.msg(result.msg_content, function(){});
                    return false;
                }
            }
        });

    }

    function checkHongBao(_this){
        return true;
    }

</script>
</body>
</html>
