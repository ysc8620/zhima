<include file="Public:header" xmlns="http://www.w3.org/1999/html"/>
<script type="text/javascript" src="/js/utils.js"></script>
<script type="text/javascript">
    onload = function() {
        if (!document.all)
        {
            document.forms['theForm'].reset();
        }
    }

</script>
        <style type="text/css">
            input.pic{position:absolute; right:0; top:0; font-size:100px; opacity:50; filter:alpha(opacity=0); z-index: 10; width: 100%; height: 100%}
        </style>
<div class="container">
	<div class="from">
        <form action="{:U('/zhao/zhaopian/add')}" method="post" enctype="multipart/form-data" name="theForm" id="theForm" onSubmit="return checkZhaopian(this)">
            <input type="hidden" name="sign" value="{$sign}" />
            <input type="hidden" name="is_rand" value="1" />
		    <ul>
			<div class="row" style="height: 200px; text-align: center; background: url(/images/bg.png) center center no-repeat #161616;">
                <input type="file" class="pic" name="imgOne" id="imgOne" onchange="preImg(this.id,'imgPre');" />
                <img id="imgPre" src="/images/touming.png" style="max-width:100%; max-height:100%; display: block; margin: 0 auto;" />
		     </div>
		</ul>
		<ul>
			<div class="row">
				<input class="fr color_999 tl text"  name="remark" maxlength="120"  id="remark" value="珍藏多年,首次公开,绝对值得" />
			</div>
		</ul>
		<ul>
			<div class="w50 fl">
				<div class="amount tr"><input type="button" data-role="set_rand" class="btn w50 " value="随机价格" /></div>
				<div class="amount_remark tr ptop6 pbottom10" style="padding-right: 12px;">￥1.05-￥5.00范围随机</div>
			</div>
            <div class="w50 fl">
                <div class="amount tl ml10"><input type="button" data-role="set_price" class="btn w50 color_def" value="设置价格" /></div>
                <div class="amount_remark ml10 ptop6 pbottom10" style="padding-left: 12px;">可设置￥1.05-￥200内</div>
            </div>
		</ul>
            <ul data-role="price_block" style="display: none">
                <div class="w50 fr">
                    <div class="amount tl ml10"><input type="number" name="amount" class="text2 color_999  w50" value="1.05" /></div>
                </div>
            </ul>
		<ul class="cl mt10">
		<div class="tit ">
			<div class="w90 mc">
			<input type="submit" class="btn" value="发 布" />
			</div>
			<div class="w90 mc tc f12 ptop6">
                发布一张朋友发红包才能看的照片
                收入会自动通过微信红包发给你
			</div>
			</div>
		</ul>
		</form>
	</div>

</div>
</div>
<include file="Public:foot" />
<script type="text/javascript">
    /**
     * 从 file 域获取 本地图片 url
     */
    /**
     * 从 file 域获取 本地图片 url
     */
    function getFileUrl(sourceId) {
        var url;
        if (navigator.userAgent.indexOf("MSIE") >= 1 && !(navigator.userAgent.indexOf("MSIE 10.0") > 0) ) { // IE10取消了滤镜
            //url = document.getElementById(sourceId).value;
            document.all.imgOne.select();
            $("#preview").focus();
            url = document.selection.createRange().text;

        } else if (navigator.userAgent.indexOf("Firefox") > 0) { // Firefox
            url = window.URL.createObjectURL(document.getElementById(sourceId).files.item(0));
        } else if (navigator.userAgent.indexOf("Chrome") > 0) { // Chrome
            url = window.URL.createObjectURL(document.getElementById(sourceId).files.item(0));
        }else if(navigator.userAgent.indexOf("MSIE 10.0") > 0){
            url = window.URL.createObjectURL(document.getElementById(sourceId).files.item(0));
        }else{
            url = window.URL.createObjectURL(document.getElementById(sourceId).files.item(0));
        }
        return url;
    }

    /**
     * 将本地图片 显示到浏览器上
     */
    function preImg(sourceId, targetId) {
        var url = getFileUrl(sourceId);
        var imgPre = document.getElementById(targetId);
        if(window.navigator.userAgent.indexOf("MSIE") >= 1 && !(navigator.userAgent.indexOf("MSIE 10.0") > 0) ) {
            var picpreview=document.getElementById("preview");
            picpreview.filters.item("DXImageTransform.Microsoft.AlphaImageLoader").src = url;
        }else{
            imgPre.src = url;
        }

    }
    function checkTextLength(obj, length) {
        if(obj.value.length > length)   {
            obj.value = obj.value.substr(0, length);
        }
    }

    function checkZhaopian(){
        var file_val = $('input[name="imgOne"]').val();
        if(file_val.length < 1){
            layer.msg('请选择要上传的照片', function(){});
            return false;
        }

        var remark = $('input[name="remark"]').val();
        if(remark.length < 1){
            layer.msg('请设置照片描述信息', function(){});
            return false;
        }


        var is_rand = $('input[name="is_rand"]').val();
        if(is_rand == '0'){
            var amount = $('input[name="amount"]').val();
            if(amount == ''){
                layer.msg('请输入照片价格', function(){});
                return false;
            }
            amount = parseFloat(amount);
            if(amount < 1.05 || amount > 200){
                layer.msg('价格范围在1.05-200之间', function(){});
                return false;
            }
        }

        return true;
    }

    $('[data-role="set_rand"]').click(function(){
        $('input[name="is_rand"]').val(1);
        $(this).removeClass('color_def');
        $('[data-role="set_price"]').addClass('color_def');
        $('[data-role="price_block"]').hide();
    });
    $('[data-role="set_price"]').click(function(){
        $('input[name="is_rand"]').val(0);
        $(this).removeClass('color_def');
        $('[data-role="set_rand"]').addClass('color_def');
        $('[data-role="price_block"]').show();
    });
</script>
</body>
</html>
