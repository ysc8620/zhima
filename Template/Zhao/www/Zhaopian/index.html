<include file="Public:header" xmlns="http://www.w3.org/1999/html"/>
<script type="text/javascript" src="/js/utils.js"></script>
<script type="text/javascript">
    onload = function() {
        if (!document.all)
        {
            document.forms['theForm'].reset();
        }
    }

</script>
<style type="text/css">
    input.pic{position:absolute; right:0; top:0; font-size:100px; opacity:0; filter:alpha(opacity=0); z-index: 10; width: 100%; height: 100%}
    .list_img{ width: 100px; height: 100px; text-align: center; border: #363636 1px solid; background: #161616; margin-right: 4px; overflow: hidden}
    .list_img_add{ width: 100px; height: 100px;  text-align: center; border: #363636 1px solid;  background: #161616; overflow: hidden}
    .list_img_add img, .list_img img{ max-height: 100px; max-width: 100px; vertical-align: middle}
</style>
<div class="container">
	<div class="from">
        <form action="{:U('/zhao/zhaopian/add')}" method="post" enctype="multipart/form-data" name="theForm" id="theForm" onSubmit="return checkZhaopian(this)">
            <input type="hidden" name="sign" value="{$sign}" />
            <input type="hidden" name="is_rand" value="1" />
		    <ul>
			<div class="row select_pic" style="height: 240px; text-align: center; background: url(/images/bg.png) center center no-repeat #161616;">
                <img id="preview" name="preview" src="/images/touming.png" style="max-width:100%; max-height:100%; display: block; margin: 0 auto;" />
		     </div>
		</ul>
        <ul class="mb10 list_img_block hide">

            <div class="list_img_add fl select_pic"><img src="/images/plus-icon.png" style="height: 90px; padding-top: 4px" /> </div>
            <div class="cl"></div>
        </ul>
		<ul>
			<div class="row">
				<input class="fr color_999 tl text"  name="remark" maxlength="120"  id="remark" value="珍藏多年,首次公开,绝对值得" />
			</div>
		</ul>
		<ul>
			<div class="w50 fl">
				<div class="amount tr"><input type="button" data-role="set_rand" class="btn w50 " value="随机价格" /></div>
				<div class="amount_remark tr ptop6 pbottom10" style="padding-right: 12px;">￥1.05-￥5.00范围随机</div>
			</div>
            <div class="w50 fl">
                <div class="amount tl ml10"><input type="button" data-role="set_price" class="btn w50 color_def" value="设置价格" /></div>
                <div class="amount_remark ml10 ptop6 pbottom10" style="padding-left: 12px;">可设置￥1.05-￥200内</div>
            </div>
		</ul>
            <ul data-role="price_block" style="display: none">
                <div class="w50 fr">
                    <div class="amount tl ml10"><input type="text" name="amount" lang="en"  class="text2 color_999  w50" value="1.05" /></div>
                </div>
            </ul>
		<ul class="cl mt10">
		<div class="tit ">
			<div class="w90 mc">
			<input type="submit" class="btn" value="发 布" />
			</div>
			<div class="w90 mc tc f12 ptop6">
                发布一张朋友发红包才能看的照片
                收入会自动通过微信红包发给你
			</div>
			</div>
		</ul>
		</form>
	</div>

</div>
</div>
<include file="Public:foot" />
<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
<script>

    wx.config({
        appId: '{$signPackage.appId}',
        timestamp: '{$signPackage.timestamp}',
        nonceStr: '{$signPackage.nonceStr}',
        signature: '{$signPackage.signature}',
        jsApiList: [
            /*
             * 所有要调用的 API 都要加到这个列表中
             * 这里以图像接口为例
             */
            "chooseImage",
            "uploadImage"
        ]
    });

    wx.ready(function () {

        var images = {
            localId: [],
            serverId: []
        };

        $('.select_pic').click(function () {
            wx.chooseImage({
                success: function (res) {
                    images.localId = res.localIds;
                    jQuery(function(){
                        $('.list_img_block').removeClass('hide');
                        $.each( res.localIds, function(i, n){
                            if($('.list_img_block img[src="'+n+'"]').size()>0){
                                return;
                            }
                            $(".list_img_add").before('<div class="list_img fl"> <img src="'+n+'" /></div>');
                        });

                    });
                }
            });
        });



        document.querySelector('#uploadImage').onclick = function () {

            if (images.localId.length == 0) {
                layer.msg('请先使用选择图片按钮', function(){});
                return;

            }

            images.serverId = [];

            jQuery(function(){
                $.each(images.localId, function(i,n) {
                    wx.uploadImage({
                        localId: n,
                        success: function (res) {
                            images.serverId.push(res.serverId);

                        },

                        fail: function (res) {
                            layer.msg(JSON.stringify(res), function(){});
                        }

                    });

                });

            });

        };




    });



</script>
<script type="text/javascript">

    function checkZhaopian(){
        try{
        var file_val = $('input[name="imgOne"]').val();
        if(file_val.length < 1){
            layer.msg('请选择要上传的照片', function(){});
            return false;
        }

        var remark = $('input[name="remark"]').val();
        if(remark.length < 1){
            layer.msg('请设置照片描述信息', function(){});
            return false;
        }


        var is_rand = $('input[name="is_rand"]').val();
        if(is_rand == '0'){
            var amount = $('input[name="amount"]').val();
            if(amount == ''){
                layer.msg('请输入照片价格', function(){});
                return false;
            }
            amount = parseFloat(amount);
            if(amount < 1.05 || amount > 200){
                layer.msg('价格范围在1.05-200之间', function(){});
                return false;
            }
        }
        }catch (e){
            layer.msg('错误:'+ e.message, function(){});
            
        }
        return true;
    }

    $('[data-role="set_rand"]').click(function(){
        $('input[name="is_rand"]').val(1);
        $(this).removeClass('color_def');
        $('[data-role="set_price"]').addClass('color_def');
        $('[data-role="price_block"]').hide();
    });
    $('[data-role="set_price"]').click(function(){
        $('input[name="is_rand"]').val(0);
        $(this).removeClass('color_def');
        $('[data-role="set_rand"]').addClass('color_def');
        $('[data-role="price_block"]').show();
    });
</script>
</body>
</html>
