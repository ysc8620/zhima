<include file="Public:header" />

<div class="container">
    <div class="detail_bg_block">&nbsp;</div>
    <div class="detail_bg">
        <img src="{$hongbao_user.header}" alt="{$hongbao_user.name}"  />
    </div>
    <div class="detail_info">
        <div class="mt40 cl"><img src="/uploads/2/20151016/zmlcms_1444966713334.jpg" class="detail_head_img" /></div>
        <div class="cl">王苏蕴</div>
        <div class="cl remark">“爱我就给我发红包”</div>
    </div>
    <div class="detail_body">
        <div class=" mc tc cl" style="width: 80px;"><button class="btn btn_cou">赏</button> </div>
        <div class="remark cl">已有12人赏红包</div>
        <div class="detail_menu cl">
            <div class="menu_detail"><</div>
        </div>
    </div>
</div>

<include file="Public:foot" />

<script type="text/javascript">
    //调用微信JS api 支付
    function jsApiCall(data)
    {
        WeixinJSBridge.invoke(
                'getBrandWCPayRequest',
                data,
                function(res){
                    //WeixinJSBridge.log(res.err_msg);
                    // alert(res.err_code+'='+res.err_desc+'='+res.err_msg);
                    // window.location.href = "/notes.html";
                    // alert('支付成功');
                    window.location.href="?show_share=1";
                    return false;
//                    window.location.reload();
//                    return false;
                    switch (res.err_msg){

                        case 'get_brand_wcpay_request:cancel':
                            // location.href="/?_a=fail&order_sn=<?php echo $order_sn;?>";
//                                alert('取消');
                            break;
                        case 'get_brand_wcpay_request:fail':
                            //location.href="/?_a=fail&order_sn=<?php echo $order_sn;?>";
//                            alert('错误');
                            break;
                        case 'get_brand_wcpay_request:ok':
                            // location.href="/?_a=done&order_sn=<?php echo $order_sn;?>&ac=<?php echo $authcode?>";
                            //alert('成功');
                            $("#shareit1").show();
                            break;
                    }
                }
        );
    }

    function callpay(data)
    {
        if (typeof WeixinJSBridge == "undefined"){
            if( document.addEventListener ){
                document.addEventListener('WeixinJSBridgeReady', jsApiCall, false);
            }else if (document.attachEvent){
                document.attachEvent('WeixinJSBridgeReady', jsApiCall);
                document.attachEvent('onWeixinJSBridgeReady', jsApiCall);
            }
        }else{
            jsApiCall(data);
        }
    }
</script>

<script type="text/javascript">
    /**
     * 生成支付订单
     */
    function set_order(){
        var id = $('input[name="id"]').val();
        var num = $('input[name="num"]').val();

        $.ajax({
            type:'post',
            url:"{:U('/hongbao/order')}",
            async:false,
            cache:false,
            data:{id:id, num:num},
            dataType:'json',
            success:function(result){
                if(result.error==0){
                    // callpay(result.data);
                    set_pay(result.data);
                }else if(result.error==1){
                    layer.msg(result.message, function(){});
                    return false;
                }else if(result.error==2){
                    $("#error_block").show();
                    setTimeout(function(){window.location.reload();}, 2000);
                }
            }
        });

    }

    function set_pay(id){
        if(!id){
            var id = $('input[name="pay_id"]').val();
        }

        if(id.length < 1){
            layer.msg('没有支付订单', function(){});
            return false;
        }
        $.ajax({
            type:'post',
            url:"{:U('/weixin/pay1')}",
            async:false,
            cache:false,
            data:{id:id},
            dataType:'json',
            success:function(result){
                if(result.error==0){
                    callpay(result.data);

                }else if(result.error==1){
                    layer.msg(result.message, function(){});
                }
            }
        });
    }


    function checkHongBao(_this){
        return true;
    }

</script>
</body>
</html>
