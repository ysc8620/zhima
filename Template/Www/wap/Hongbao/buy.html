<include file="Public:header" />
<div class="container">
    <div class="mod_container">
        <div id="detailCon" class="wx_wrap">
            <div class="">
                <div class="my_head hongbao_bg">
                    <div class="my_head_pic">
                        <img width="130" height="130" src="{$user.header}" class="my_head_img">
                    </div>
                    <div class="my_head_info">
                        <h4 class="my_head_name ">{$user.name}</h4>
                    </div>

                    <div class="clear"></div>

                </div>
                <div class="hongbao_info">
                    <span class="hongbao_user">{$user.name}发起了一个凑红包</span><br />
                    <span class="hongbao_remark">红包凑齐后，随机抽出一名幸运星</span>
                </div>

                <div class="hongbao_info">
                    <span class="hongbao_user">目标金额￥{$hongbao.total_amount}元</span>
                </div>

                <div class="hongbao_jindu">
                    <div class="hongbao_jindu_bg">
                        <div class="hongbao_jindu_f" style="color:#fff; text-align:center; width: {:ceil($hongbao[total_num]/$hongbao[total_part]*100)}%">
                            {:ceil($hongbao[total_num]/$hongbao[total_part]*100)}%
                        </div>
                    </div>
                </div>
                <div class="hongbao_info">
                    <span class="hongbao_remark">每份{$hongbao.part_amount}元，共{$hongbao.total_part}份，还差{$hongbao[total_part]-$hongbao[total_num]}份凑成。</span><br />
                </div>
                <form action="{:U('/hongbao/order')}" method="post" name="theForm" id="theForm" onSubmit="return checkHongBao(this)">
                    <input type="hidden" name="id" value="{$hongbao.number_no}" />
                    <input type="hidden" name="sign" value="{$sign}" />
                    <input type="hidden" name="part_amount" value="{$hongbao.part_amount}" />
                    <input type="hidden" name="max_total" value="{$hongbao['total_part']-$hongbao['total_num']}" />
                <!--//start -->
                <div class="order ">
                    <div class="wx_wrap">
                        <div class="address_new">
                            <div class="hongbao_info">
                                <span class="hongbao_remark">您需要支付：￥<span class="part_amount">{$hongbao.part_amount}</span>元</span><br />
                            </div>
                            <div style="text-align: center">
                                <label for="num"><span class="tit"></span>
                                    <input type="button" class="jian" value="-" style="width: 30px; margin-right: 2px;"><input name="num" type="text" class="inputBg" readonly id="num" style="width: 100px; margin: 0 auto; text-align: center" value="1" placeholder="总份数"/><input class="jia" style="width: 30px; margin-left: 2px;" type="button" value="+"> <span class="" style="line-height: 36px; font-size:16px;">份</span>
                                    <span id="updateTip2" style="color: red; display: none;"></span> </label>
                            </div>

                            <p class="action">
                                <if condition="$hongbao.state eq 1">
                                    <if condition="$hongbao[addtime]+86400 gt time()">
                                <button type="submit" class="submit" id="add">凑 红 包</button>
                                        <else/>
                                        <button class="submit" disabled id="add">已 过 期</button>
                                    </if>
                                    <else/>
                                    <button class="submit" id="add" disabled><if condition="$hongbao.state eq 2">已完成<elseif condition="$hongbao.state eq 3" />已过期<elseif condition="$hongbao.state eq 4" />已退款<else />已关闭</if></button>
                                    </if>
                            </p>
                        </div>
                    </div>
                </div>
                </form>
                <!--//end-->
                <div class="state_btn"> <a class='state_btn_4' href="{:U('/hongbao/detail',array('id'=>$hongbao[number_no]))}">返回红包详情</a> </div>
            </div>

        </div>
    </div>
</div>
<include file="Public:foot" />
<script type="text/javascript">
    $('input.jian').click(function(){
        var num = parseInt($('input[name="num"]').val());
        if(num > 1){
            $('input[name="num"]').val( num-1 );
            $('input.jia').attr('disabled', false);
        }else{
            $('input.jian').attr('disabled', true);
        }
    });

    $('input.jia').click(function(){
        var num = parseInt($('input[name="num"]').val());
        var total = parseInt($('input[name="max_total"]').val());
        if(num < total){
            $('input[name="num"]').val( num+1 );
            $('input.jian').attr('disabled', false);
        }else{
            $('input.jia').attr('disabled', true);
        }
    });
    function checkHongBao(_this){
        return true;
    }
</script>
</body>
</html>
