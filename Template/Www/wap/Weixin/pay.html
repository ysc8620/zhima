<include file="Public:header" />
<script type="text/javascript">
    //调用微信JS api 支付
    function jsApiCall(data)
    {
        WeixinJSBridge.invoke(
                'getBrandWCPayRequest',
                data,
                function(res){
                    //WeixinJSBridge.log(res.err_msg);
                    // alert(res.err_code+res.err_desc+res.err_msg);
                    window.location.href = "/notes.html";
                }
        );
    }

    function callpay(data)
    {
        if (typeof WeixinJSBridge == "undefined"){
            if( document.addEventListener ){
                document.addEventListener('WeixinJSBridgeReady', jsApiCall, false);
            }else if (document.attachEvent){
                document.attachEvent('WeixinJSBridgeReady', jsApiCall);
                document.attachEvent('onWeixinJSBridgeReady', jsApiCall);
            }
        }else{
            jsApiCall(data);
        }
    }
</script>
<script type="text/javascript">
    /*
     //获取共享地址
     function editAddress()
     {
     WeixinJSBridge.invoke(
     'editAddress',
     <?php echo $editAddress; ?>,
     function(res){
     var value1 = res.proviceFirstStageName;
     var value2 = res.addressCitySecondStageName;
     var value3 = res.addressCountiesThirdStageName;
     var value4 = res.addressDetailInfo;
     var tel = res.telNumber;

     alert(value1 + value2 + value3 + value4 + ":" + tel);
     }
     );
     }

     window.onload = function(){
     if (typeof WeixinJSBridge == "undefined"){
     if( document.addEventListener ){
     document.addEventListener('WeixinJSBridgeReady', editAddress, false);
     }else if (document.attachEvent){
     document.attachEvent('WeixinJSBridgeReady', editAddress);
     document.attachEvent('onWeixinJSBridgeReady', editAddress);
     }
     }else{
     editAddress();
     }
     };
     */
</script>
<div class="container">
    <div class="mod_container">
        <div id="detailCon" class="wx_wrap">
            <div class="">
                <div class="my_head hongbao_bg">
                    <div class="my_head_pic">
                        <img width="130" height="130" src="{$user.header}" class="my_head_img">
                    </div>
                    <div class="my_head_info">
                        <h4 class="my_head_name ">{$user.name}</h4>
                    </div>

                    <div class="clear"></div>

                </div>
                <div class="hongbao_info">
                    <span class="hongbao_user">{$user.name}发起了一个凑红包</span><br />
                    <span class="hongbao_remark">红包凑齐后，随机抽出一名幸运星</span>
                </div>

                <div class="hongbao_info">
                    <span class="hongbao_user">目标金额￥{$hongbao.total_amount}元</span>
                </div>

                <div class="hongbao_jindu">
                    <div class="hongbao_jindu_bg">
                        <div class="hongbao_jindu_f" style="color:#fff; text-align:center; width: {:ceil($hongbao[total_num]/$hongbao[total_part]*100)}%">
                            {:ceil($hongbao[total_num]/$hongbao[total_part]*100)}%
                        </div>
                    </div>
                </div>
                <div class="hongbao_info">
                    <span class="hongbao_remark">每份{$hongbao.part_amount}元，共{$hongbao.total_part}份，还差{$hongbao[total_part]-$hongbao[total_num]}份凑成。</span><br />
                </div>

                    <!--//start -->
                    <div class="order ">
                        <div class="wx_wrap">
                            <div class="address_new">
                                <div class="hongbao_info">
                                    <span class="hongbao_remark">你凑了：{$order['part_num']}份</span><br />
                                </div>
                                <div class="hongbao_info">
                                    <span class="hongbao_remark">您需要支付：￥<span class="part_amount">{$order['total_amount']}</span>元</span><br />
                                </div>
                                <p class="action">
                                    <if condition="$hongbao.state eq 1">
                                        <if condition="$hongbao[addtime]+86400 gt time()">
                                            <button type="submit" class="submit" onclick="pay('{$id}')"  id="add">立即支付</button>
                                            <else/>
                                            <button class="submit" disabled id="add">已 过 期</button>
                                        </if>
                                        <else/>
                                        <button class="submit" id="add" disabled><if condition="$hongbao.state eq 2">已完成<elseif condition="$hongbao.state eq 3" />已过期<elseif condition="$hongbao.state eq 4" />已退款<else />已关闭</if></button>
                                    </if>
                                </p>
                            </div>
                        </div>
                    </div>
                <!--//end-->
                <div class="state_btn"> <a class='state_btn_4' href="{:U('/hongbao/detail',array('id'=>$hongbao[number_no]))}">返回详情</a> </div>
            </div>

        </div>
    </div>
</div>
<include file="Public:foot" />

<script type="text/javascript">

    function pay(id){alert(333);
        $.ajax({
            type:'post',
            url:"{:U('/weixin/pay1')}",
            async:false,
            cache:false,
            data:{id:id},
            dataType:'json',
            success:function(result){
                //alert(result.data);
                if(result.error==0){
                    callpay(result.data);

                }else if(result.error==1){
                    alert(result.message);

                }
            }
        });
    }
</script>

</body>
</html>